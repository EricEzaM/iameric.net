{"componentChunkName":"component---src-templates-article-jsx","path":"/articles/github-service-bot-account","result":{"data":{"post":{"html":"<p>I saw my Github activity chart on my profile earlier today and thought that the last few months looked a <em>bit</em> too active, knowing how much I had actually done. I tracked this down to being a scheduled Github Action which was updating and pushing a <a href=\"https://github.com/EricEzaM/godot-github-overview\">small website</a> (a utility for Godot pull requests) to Github Pages every day at midnight UTC. Every single time this action ran successfully it made a commit under my name. A bit annoying, to be honest, so I thought it would be best to find a way to stop that from happening.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.31288343558282%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABIElEQVQY012QW0/CQBSE+f//QqOvBhN9MD5ICCqpcpOLUIUqVblWut2lpXa3n0tDfDA5k5nMnExOTukny8i0JvvHutCa3OSYzGC0Ic/zv0zbLDtwsVv4hlKoIqbqk6UM8JTPJJqy95SKiZRippZM5BRfzniYPXHhV3DWHSorh7YY8CI9emJEQ/SQemsLhaITPFNbNbgLmjyGXbqbEfNwTRCGhb4NGvQWLqfDMscf5xy5Z5yMy9xHTapzh8vFDVfLKl9qYQtlRH/uMlyP8YTPOHzHkz5iK1HbuLiwJ1wmNmuJPvWwTT1o0d4MeJVvOJsO1/MajaDLLkspJcmOZJuwiy3HCbEt0Yd/7YEdK9C5xhhTgIOdpikiVYy/p0j7nr35C9fcdjomEpVfAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Github Activity\"\n        title=\"Github Activity\"\n        src=\"/static/508fa363d07fddafbea023d75c8cd99f/a6d36/github-activity.png\"\n        srcset=\"/static/508fa363d07fddafbea023d75c8cd99f/222b7/github-activity.png 163w,\n/static/508fa363d07fddafbea023d75c8cd99f/ff46a/github-activity.png 325w,\n/static/508fa363d07fddafbea023d75c8cd99f/a6d36/github-activity.png 650w,\n/static/508fa363d07fddafbea023d75c8cd99f/f3c12/github-activity.png 764w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h1>Making a Github Service Account</h1>\n<p>A \"Service Account\" is really just a personal account which is used for \"bot-like\" activities. Github states in their <a href=\"https://docs.github.com/en/github/getting-started-with-github/learning-about-github/types-of-github-accounts\">own documentation</a> <em>\"User accounts are intended for humans, but you can give one to a robot, such as a continuous integration bot, if necessary.\"</em>.</p>\n<p>So, first I created a new account, creatively named <em>\"EricEzaM-bot\"</em>. I used the same email as my original account by making use of the <a href=\"https://gmail.googleblog.com/2008/03/2-hidden-ways-to-get-more-from-your.html\">gmail address with a plus sign in it</a> trick.</p>\n<h1>Using it for Actions</h1>\n<p>The code in my action used my Github account to access the <a href=\"https://docs.github.com/en/graphql\">Github GraphQL API</a> to get data, and also to make the pushes to the <code class=\"language-text\">gh-pages</code> branch via the action <a href=\"https://github.com/JamesIves/github-pages-deploy-action\"><em>JamesIves/github-pages-deploy-action</em></a>. The former just used a Personal Access Token, which was easy enough to generate by going to <code class=\"language-text\">Settings</code> > <code class=\"language-text\">Developer Settings</code> > <code class=\"language-text\">Personal access tokens</code> in my bot account and then including the Personal access token (PAT) in the action <code class=\"language-text\">yaml</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n      <span class=\"token comment\"># The access token is used within a .NET Core application to call the Github GraphQL API</span>\n      <span class=\"token key atrule\">ACCESS_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ACCESS_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>To have the bot be able to edit code in your repository, you need to add it as a \"Contributor\" for the repo. There is Github <a href=\"https://docs.github.com/en/github/setting-up-and-managing-your-github-user-account/managing-access-to-your-personal-repositories/inviting-collaborators-to-a-personal-repository\">documentation</a> on how to do this.</p>\n<p>Unfortunately the same PAT strategy did not work for the Github Pages deployment. Even if I declared <code class=\"language-text\">token: ${{ secrets.ACCESS_TOKEN }}</code> in my <code class=\"language-text\">github-pages-deploy-action</code> configuration, the run would fail, stating <em>\"Permission to EricEzaM/godot-github-overview.git denied to EricEzaM-bot\"</em>. Hmm... not ideal.</p>\n<p>After a bit of Googling and reading, I found that switching to using a SSH deploy key rather than the token worked, for some seemingly unknown reason. I followed the steps in the <a href=\"https://github.com/JamesIves/github-pages-deploy-action#using-an-ssh-deploy-key-\">documentation</a> for the GH pages deploy action; generating a public/private key pair using the credentials of my bot account, then adding the public key as a \"Deploy Key\" in the repository, and the private key as a secret called <code class=\"language-text\">DEPLOY_KEY</code>. Don't forget, when you copy the keys include the newlines at the end of each, as well as the <code class=\"language-text\">-----BEGIN RSA PRIVATE KEY-----</code> and <code class=\"language-text\">-----END RSA PRIVATE KEY-----</code> text. </p>\n<p>When I tried this I was <em>still</em> getting issues. The deploy worked, but it was in the repo owner account name (my main account, EricEzaM). The last thing I tried was adding the <code class=\"language-text\">git-config-name</code> and <code class=\"language-text\">git-config-email</code> for the bot account to override the defaults. At last, it worked. My final GH pages deploy action looked like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># GH Pages Deployment</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> GH Pages Deployment\n    <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> JamesIves/github<span class=\"token punctuation\">-</span>pages<span class=\"token punctuation\">-</span>deploy<span class=\"token punctuation\">-</span>action@releases/v4\n    <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">git-config-name</span><span class=\"token punctuation\">:</span> EricEzaM<span class=\"token punctuation\">-</span>bot\n      <span class=\"token key atrule\">git-config-email</span><span class=\"token punctuation\">:</span> 86031079+EricEzaM<span class=\"token punctuation\">-</span>bot@users.noreply.github.com\n      <span class=\"token key atrule\">ssh-key</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DEPLOY_KEY <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">branch</span><span class=\"token punctuation\">:</span> gh<span class=\"token punctuation\">-</span>pages\n      <span class=\"token key atrule\">folder</span><span class=\"token punctuation\">:</span> ./web<span class=\"token punctuation\">-</span>frontend\n      <span class=\"token key atrule\">single-commit</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<h1>Summing up</h1>\n<p>So, now my automated deploys are no longer in my main account's name and my profile contribution graph will be artificially inflated no longer... (yay?)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.65030674846626%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABU0lEQVQoz2VSy04DMQzc//8HPoAbXIErP8CFXhCPCrVVu488HCfZJIOTbbUFLFmRs2N7ZjadIwIzY55nhODb6b1HKRlrlHMCOSVYSw3Xej3j8fMZ929PeJ+26I7KoDcOhgMMeRgXoCzDhQSOBX4uiDI7JrSz3g+aGm5UhNEQbl8fcPNyh03/gW67O+B7847dfsBhcjgMhH3NkfF1dDgqhuKC0eWW2hfoAJxMECIRJymsKXBWNMjCThuRx06qgutwjkEircoja4V9wGkisSUsJpS1JYh8LfKT2NEpAWb50lyq5zmJxAZjJO06cLTNZ/zBxjjDCj7njG4QhtXcZeMKqoPUpKCUhtYao2bse3vFcMHViDFCy/KUZCCJtEtxDax/nmRRZcrOgThiaJL9v4HznOAE3xgaazBOUysqIOczQ/ub4WQYh960J9Wej+AvPQtD20j9AP40bUU4seKpAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Bot does deploy\"\n        title=\"Bot does deploy\"\n        src=\"/static/4d61daa891f529d85a653a63c32fa407/a6d36/bot-does-deploy.png\"\n        srcset=\"/static/4d61daa891f529d85a653a63c32fa407/222b7/bot-does-deploy.png 163w,\n/static/4d61daa891f529d85a653a63c32fa407/ff46a/bot-does-deploy.png 325w,\n/static/4d61daa891f529d85a653a63c32fa407/a6d36/bot-does-deploy.png 650w,\n/static/4d61daa891f529d85a653a63c32fa407/f79fa/bot-does-deploy.png 940w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>This is probably a pretty niche issue, but it was something I spent a bit of time on figuring out - so hopefully it helps someone else out there!</p>","frontmatter":{"title":"Creating and using a Github \"Service Account\" for Github Actions","date":"Thursday June 17th, 2021","tags":["Github","Devops"],"headerImage":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABIElEQVQY012QW0/CQBSE+f//QqOvBhN9MD5ICCqpcpOLUIUqVblWut2lpXa3n0tDfDA5k5nMnExOTukny8i0JvvHutCa3OSYzGC0Ic/zv0zbLDtwsVv4hlKoIqbqk6UM8JTPJJqy95SKiZRippZM5BRfzniYPXHhV3DWHSorh7YY8CI9emJEQ/SQemsLhaITPFNbNbgLmjyGXbqbEfNwTRCGhb4NGvQWLqfDMscf5xy5Z5yMy9xHTapzh8vFDVfLKl9qYQtlRH/uMlyP8YTPOHzHkz5iK1HbuLiwJ1wmNmuJPvWwTT1o0d4MeJVvOJsO1/MajaDLLkspJcmOZJuwiy3HCbEt0Yd/7YEdK9C5xhhTgIOdpikiVYy/p0j7nr35C9fcdjomEpVfAAAAAElFTkSuQmCC","aspectRatio":4.25531914893617,"src":"/static/508fa363d07fddafbea023d75c8cd99f/f7db6/github-activity.png","srcSet":"/static/508fa363d07fddafbea023d75c8cd99f/8ac63/github-activity.png 200w,\n/static/508fa363d07fddafbea023d75c8cd99f/3891b/github-activity.png 400w,\n/static/508fa363d07fddafbea023d75c8cd99f/f7db6/github-activity.png 764w","sizes":"(max-width: 764px) 100vw, 764px"}}}},"timeToRead":3}},"pageContext":{"slug":"github-service-bot-account"}},"staticQueryHashes":["1277554887","63159454"]}